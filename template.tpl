___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Blitzllama Tag",
  "categories": [
    "SURVEY",
    "ANALYTICS",
    "CONVERSIONS"
  ],
  "brand": {
    "id": "brand_custom_template",
    "displayName": "Blitzllama Tag",
    "thumbnail": "data:image/png;base64,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"
  },
  "description": "Blitzllama tag enables customers to install Blitzllama sdk on their website and carry on tasks like user creation, user attribute updates. Please do check documentation at https://documentation.blitzllama.com/sdk/google-tag-manager",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "api_key",
    "displayName": "API key",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
 {
    "type": "GROUP",
    "name": "actionGroup",
    "displayName": "Action Type",
    "groupStyle": "NO_ZIPPY",
    "subParams": [
      {
        "type": "SELECT",
        "name": "actionsMenu",
        "displayName": "",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "user_id",
            "displayValue": "User Id"
          },
          {
            "value": "attribute",
            "displayValue": "User Attribute"
          }
        ],
        "simpleValueType": true
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "attributeGroup",
    "displayName": "",
    "groupStyle": "NO_ZIPPY",
    "subParams": [
      {
        "type": "TEXT",
        "name": "attribute_name",
        "displayName": "Attribute Key",
        "simpleValueType": true,
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      },
      {
        "type": "TEXT",
        "name": "attribute_value",
        "displayName": "Attribute Value",
        "simpleValueType": true,
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      },
      {
        "type": "SELECT",
        "name": "data_type",
        "displayName": "Data type",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "string",
            "displayValue": "String"
          },
          {
            "value": "number",
            "displayValue": "Number"
          },
          {
            "value": "date",
            "displayValue": "Date"
          },
          {
            "value": "boolean",
            "displayValue": "Boolean"
          }
        ],
        "simpleValueType": true,
        "defaultValue": "string",
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      }  
    ],
    "enablingConditions": [
      {
        "paramName": "actionsMenu",
        "paramValue": "attribute",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "userIdGroup",
    "displayName": "User Id",
    "groupStyle": "NO_ZIPPY",
    "subParams": [
      {
        "type": "TEXT",
        "name": "userId",
        "displayName": "",
        "simpleValueType": true,
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      }
    ],
    "enablingConditions": [
      {
        "paramName": "actionsMenu",
        "paramValue": "user_id",
        "type": "EQUALS"
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const setInWindow = require('setInWindow');
const injectScript = require('injectScript');
const callInWindow = require('callInWindow');
const copyFromWindow = require('copyFromWindow');
const logToConsole = require('logToConsole');
const url = "https://cdn.blitzllama.com/js/blitz.js";

const action = () => {
  callInWindow('_blitzQueue.push', ['init', data.api_key]);

  if (data.actionsMenu === 'user_id') {
    callInWindow('_blitzQueue.push', ['createUser', data.userId]);
    logToConsole('user_id', data.userId, data);
  } else if (data.actionsMenu === 'attribute') {
    callInWindow('_blitzQueue.push', ['setUserAttribute', data.attribute_name, data.attribute_value, data.data_type]);
    logToConsole('attribute', data);
  } 
  data.gtmOnSuccess();
};

const onSetupSuccess = () => {
  logToConsole('blitz: Script loaded successfully.');
  action();
};

const onSetupFailure = () => {
  logToConsole('blitz: Script failed to load');
  data.gtmOnFailure();
};

const setup = (onSuccess, onFailure) => {
  setInWindow('blitz', function(){
    callInWindow('_blitzQueue.push', arguments);
  });
  setInWindow('_blitzQueue', []);
  injectScript(url, onSetupSuccess, onSetupFailure);
};

setup();

const blitz = copyFromWindow('blitz');
logToConsole('blitz1',blitz);
logToConsole('data.api_key1',data.api_key);
logToConsole('data1',data);
if (blitz && data.api_key) {
  action();
}  else {
  logToConsole('Blitz: Script failed at installation.');
  data.gtmOnFailure();
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "blitz"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "_blitzQueue"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "_blitzQueue.push"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://cdn.blitzllama.com/js/blitz.js"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 26/04/2022, 6:20:00 PM